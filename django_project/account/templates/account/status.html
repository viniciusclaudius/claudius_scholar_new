{% extends 'base.html' %}
{% block content %}
{% load static %}

<link rel="stylesheet" href='{% static "/profile.css" %}' type="text/css">

<head>
    <script src="https://js.stripe.com/v3/"></script>
</head>

<div class="top-row">
    <h4 class="top-name">Status</h4>
</div>
<hr class="line">
<div class="form-container">
    <div id="message">
    </div>
</div>

<script>
    // Initialize Stripe.js using your publishable key
    const stripe = Stripe('pk_test_51HQkdwI9v8S2LzxgG4059754Zo0SJ7kEJ5zLM4Wr1Ns2P7q8Hmvt03Y7Gtt4HgzECE2DjUUdpkrLDjTMdQElJTiV005BZunuND');

    // Retrieve the "setup_intent_client_secret" query parameter appended to
    // your return_url by Stripe.js
    const clientSecret = new URLSearchParams(window.location.search).get(
    'setup_intent_client_secret'
    );

    // Retrieve the SetupIntent
    stripe.retrieveSetupIntent(clientSecret).then(({setupIntent}) => {
    const message = document.querySelector('#message')

    // Inspect the SetupIntent `status` to indicate the status of the payment
    // to your customer.
    //
    // Some payment methods will [immediately succeed or fail][0] upon
    // confirmation, while others will first enter a `processing` state.
    //
    // [0]: https://stripe.com/docs/payments/payment-methods#payment-notification
    switch (setupIntent.status) {
        case 'succeeded': {
            message.innerText = 'Success! Your payment method has been saved.';
            break;
        }

        case 'processing': {
            message.innerText = "Processing payment details. We'll update you when processing is complete.";
            break;
        }

        case 'requires_payment_method': {
            message.innerText = 'Failed to process payment details. Please try another payment method.';

            // Redirect your user back to your payment page to attempt collecting
            // payment again

            break;
        }
    }
    });
</script>

{% endblock %}